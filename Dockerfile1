FROM us.gcr.io/cloud-data-fusion-images/cloud-data-fusion:latest
  
RUN rm -rf /opt/cdap/master/ext/runtimeproviders \
 && rm -rf /opt/cdap/master/ext/runtimes \
 && rm -rf /opt/cdap/master/ext/environments \
 && ls -la /opt/cdap/master/ext/metricswriters \
 && rm -rf /opt/cdap/master/ext/metricswriters \
 && echo "after" && ls -la /opt/cdap/master/ext/ \
 && rm -rf /opt/cdap/master/lib/io.cdap.cdap.cdap* \
 && rm -rf /opt/cdap/master/artifacts/spark2_2.11 \
 && rm -rf /opt/cdap/master/artifacts/spark3_2.12

COPY opt/cdap/master/lib /opt/cdap/master/lib
COPY opt/cdap/master/ext /opt/cdap/master/ext
COPY opt/cdap/master/artifacts/spark2_2.11/* /opt/cdap/master/artifacts/spark2_2.11/
COPY opt/cdap/master/artifacts/spark3_2.12/* /opt/cdap/master/artifacts/spark3_2.12/
COPY opt/cdap/master/ext/metricswriters/google_cloud_monitoring_writer/* /opt/cdap/master/ext/metricswriters/google_cloud_monitoring_writer/


#RUN groupadd -g 1000 cdap
#RUN useradd -m -u 1000 -g 1000 cdap
#RUN mkdir /data
RUN chown 1000:1000 /data
RUN chmod 766 /data

RUN chmod -R 777 /opt/cdap
